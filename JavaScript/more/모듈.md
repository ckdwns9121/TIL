# 모듈

## 모듈이란

개발하는 애플리케이션이 커지면 소스코드를 여러개로 분리해야 하는데 이때 분리된 파일 하나하나를 모듈(module)이라고 부른다.

## 자바스크립트 모듈

자바스크립트는 다음과 같은 모듈 시스템이 있다.

- AMD : 가장 오래된 모듈 시스템중 하나로 `require.js`라는 라이브러리를 통해 처음 개발됨
- CommonJs: Node.js 서버를 위해 만들어진 모듈
- UMD: AMD와 CommonJs와 같은 다양한 모듈 시스템을 함께 사용하기 위해 만듦

## 모듈의 핵심 기능

### 엄격 모드로 실행된다.

모듈은 항상 `엄격 모드(use strict)`로 실행된다.

```html
<script type="module">
  a = 5; // 에러
</script>
```

### 모듈 레벨 스코프

모듈은 자신만의 스코프가 있다.

## 브라우저 특정 기능

브라우저 환경에서 `type=module` 이 붙은 스크립트가 있다.

### 지연 실행

모듈 스크립트는 항상 지연 실행 된다. 외부 스크립트, 인라인 스크립트와 관계없이 마치 `defer`속성을 붙인 것 처럼 실행된다.

> defer: 페이지가 모두 로드된 후에 해당 외부 스크립트가 실행됨을 명시

### 외부 스크립트

`type=module`이 붙은 외부 모듈 스크립트엔 두 가지 특징이 있다.

1. `src` 속성 값이 동일한 외부 스크립트는 한번만 실행된다.

```html
<!-- my.js는 한번만 로드 및 실행됩니다. -->
<script type="module" src="my.js"></script>
<script type="module" src="my.js"></script>
```

2. 외부 사이트 같이 다른 오리진에서 모듈 스크립트를 불러오면 **CORS** 헤더가 필요하다.

```html
<!-- another-site.com이 Access-Control-Allow-Origin을 지원해야만 외부 모듈을 불러올 수 있습니다.-->
<!-- 그렇지 않으면 스크립트는 실행되지 않습니다.-->
<script type="module" src="http://another-site.com/their.js"></script>
```

### 경로가 없는 모듈은 금지

```js
import { sayHi } from "sayHi"; // Error!
// './sayHi.js'와 같이 경로 정보를 지정해 주어야 합니다.
```

### 호환성

구식 브라우저나 브라우저 환경이 아니면 `type=module`을 해석하지 못하기 때문에 빌드를 해서 써야한다.

## 빌드 툴

- 웹팩과 같은 번들링 툴을 사용해 모듈을 한데 묶어(번들링) 프로덕션 서버에 올리는 방식을 사용한다.

- 번들링 툴을 사용하면 스크립트를 하나 혹은 여러개의 파일로 번들링 된다. 번들링 과정이 끝나면 `type=module`을 쓰지않고 일반 스크립트 처럼 불러와서 사용가능

```html
<!-- 웹팩과 같은 툴로 번들링 과정을 거친 스크립트인 bundle.js -->
<script src="bundle.js"></script>
```
